
@{
    /**/

    ViewBag.Title = "User Master";
}
@Html.AntiForgeryToken()
<div class="box box-warning">
    <div class="box-header with-border">
        <div class="box-header-left" style="width: 100%;">
            <h3 class="box-title">User Master</h3>
            <button class="button btn-small pull-right" onclick="ClearControls();"><i class="fa fa-plus-circle"></i></button>
        </div>
    </div>
    <div class="box-body">
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <div id="tblUserMaster"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@*<div id="PopUpUser"></div>*@

<div class="modal fade" id="PopUpAdd" tabindex="-1" role="dialog" aria-labelledby="logoutLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false" style="padding-left: 230px !important; z-index: 1050 !important;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Add User</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Title<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="ddlTitle"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">First Name<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtFName"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Middle Name</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtMName"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Last Name<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtLName"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Email<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtEmail"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Mobile No.<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtMobileNo"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Password<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtPassword"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Password Exp Date<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtPasswordExpDate"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">IP Address</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtIPAddress"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">User Type<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="ddlUserType"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Company Name<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="ddlIdentityType"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Active<span style="color:red">*</span></label>
                                <div class="col-sm-9 MY8">
                                    <div id="chkActive"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top: 10px;">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">&nbsp;</label>
                                <div class="col-sm-9">
                                    <button type="button" class="button btn-sm pull-right" data-dismiss="modal" style="margin-left: 5px;">Cancel</button>
                                    <button type="button" class="button btn-sm pull-right" onclick="UserMasterInsert();" style="margin-left: 5px;">Save</button>
                                    <button type="button" class="button btn-sm pull-right" id="BtnSuper" onclick="ShowSuperStockistsPopup();" style="display:none;">Select Super Stockists</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="PopUpActive" tabindex="-1" role="dialog" aria-labelledby="logoutLabel" aria-hidden="true" style="padding-left: 230px !important; z-index: 1050 !important;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Change User Status</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="row">

                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Name</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtFNameStatus"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Email</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtEmailStatus"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Active</label>
                                <div class="col-sm-9 MY8">
                                    <div id="chkActiveStatus"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top: 10px;">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">&nbsp;</label>
                                <div class="col-sm-9">
                                    <button type="button" class="button btn-sm pull-right" data-dismiss="modal" style="margin-left: 5px;">Cancel</button>
                                    <button type="button" class="button btn-sm pull-right" onclick="UserMasterStatusUpdate();">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="PopUpChangePassword" tabindex="-1" role="dialog" aria-labelledby="logoutLabel" aria-hidden="true" style="padding-left: 230px !important; z-index: 1050 !important;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Change Password</h4>
                <button type="button" class="close" aria-hidden="true" onclick="cancelPopup()">&times;</button>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Email</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtCPEmail"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">New Password</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtChangePassword"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">Confirm Password</label>
                                <div class="col-sm-9 MY8">
                                    <div id="txtConfirmPassword"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top: 10px;">
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="">&nbsp;</label>
                                <div class="col-sm-9">
                                    <button type="button" class="button btn-sm pull-right" style="margin-left: 5px;" onclick="cancelPopup()">Cancel</button>
                                    <button type="button" class="button btn-sm pull-right" onclick="UserMasterChangePassword();">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="PopUpSuperstockists" tabindex="-1" role="dialog" aria-labelledby="logoutLabel" aria-hidden="true" style="padding-left: 211px !important; z-index: 1050 !important;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="SuperstockistsLabel">Select Super stockists</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <div ID="PlaceHolder1" runat="server"></div>
            </div>
            <div class="col-md-12" style="margin-bottom: 10px;">
                <div class="form-group">
                    <label class="control-label col-sm-3" for="">&nbsp;</label>
                    <div class="col-sm-9">
                        <button type="button" class="button btn-sm pull-right" style="margin-left: 5px;" onclick="CloseSuperstockistPopup()">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="HiddenUserId" />
<input type="hidden" id="HdnSelSuperStockists" />
<script>
    var now = new Date();
    $("#txtFName").dxTextBox({
        height: 30
    });
    $("#txtMName").dxTextBox({
        height: 30
    });
    $("#txtLName").dxTextBox({
        height: 30
    });
    $("#txtEmail").dxTextBox({
        height: 30
    });
    $("#txtMobileNo").dxTextBox({
        height: 30
    });
    $("#txtPasswordExpDate").dxDateBox({
        height: 30,
        type: "date",
        value: now,
        min: new Date(),
        displayFormat: "shortdate",
    });
    $("#txtIPAddress").dxTextBox({
        height: 30
    });
    $("#txtPassword").dxTextBox({
        height: 30,
         mode: 'password',
    });
    $("#chkActive").dxCheckBox({
        height: 30
    });

     $("#txtFNameStatus").dxTextBox({
         height: 30,
         readOnly: true
    });

     $("#txtEmailStatus").dxTextBox({
         height: 30,
         readOnly: true
     });
    $("#chkActiveStatus").dxCheckBox({
        height: 30
    });
     $("#txtCPEmail").dxTextBox({
         height: 30,
         readOnly: true
     });
     $("#txtChangePassword").dxTextBox({
         height: 30,
         mode: 'password'
     });
     $("#txtConfirmPassword").dxTextBox({
         height: 30,
         mode: 'password',
         onValueChanged: function(data) {
           CheckPassword()
        }
     });

    var ListUserType = [];
    var ListSalutation = [];

      arrayCr = @Html.Raw(Json.Encode(@ViewBag.ParameterListUserType));
    if(arrayCr !=null)
    {
        for(var i = 0; i < arrayCr.length; i++){
            ListUserType[i] = arrayCr[i];
        }
    }

      arrayCr = @Html.Raw(Json.Encode(@ViewBag.ParameterListSalutation));
    if(arrayCr !=null)
    {
        for(var i = 0; i < arrayCr.length; i++){
            ListSalutation[i] = arrayCr[i];
        }
    }
    var ListUser = [];
    var VarddlUserType = "";
    var ListIdentityType = [];
    var varIdentityType = "";
    var now = new Date();


    $(document).ready(function () {
        UserMasterGetAll();
          $("#ddlTitle").dxSelectBox({
           height: 30,
           dataSource: new DevExpress.data.ArrayStore({
                data: ListSalutation,
                key: "ParameterKey"
            }),
            displayExpr: "Description",
            valueExpr: "ParameterKey",
            placeholder: "Select Salutation",
            onValueChanged: function (data) {
                varddlUserType = data.value;
                //IdentityGetByUserType(data.value);
            }

          });

        $("#ddlUserType").dxSelectBox({
           height: 30,
           dataSource: new DevExpress.data.ArrayStore({
                data: ListUserType,
                key: "ParameterKey"
            }),
            displayExpr: "Description",
            valueExpr: "ParameterKey",
            placeholder: "Select User Type",
            onValueChanged: function (data) {
                varddlUserType = data.value;
                //alert(varddlUserType == "23");
                //IdentityGetByUserType(data.value);
                if (varddlUserType == "23") {
                    $("#BtnSuper").attr('style', 'display: block');
                }
                else {
                    $("#BtnSuper").attr('style', 'display: none');
                }
            }

        });
        IdentityGetByUserType();
    });

    function BindUserMaster() {
        $("#tblUserMaster").dxDataGrid({
            dataSource: ListUser,
            height: 555,
            paging: { enabled: true },
              paging: {
            pageSize: 10
        },
        pager: {
            showPageSizeSelector: true,
            allowedPageSizes: [5, 10, 15],
            showInfo: true
        },
            allowColumnResizing: true,
            columnResizingMode: "widget",
            columnAutoWidth: true,
            wordWrapEnabled: false,
            columns: [
                { dataField: "ZZTitle", width: '16%', caption: "UserName" },
                { dataField: "ZZIdentity", width: '16%', caption: "Company " },
                { dataField: "EmailID", width: '16%', caption: "Email" },
                { dataField: "Mobile", width: '9%', caption: "Mobile No." },

                 {
                    dataField: "ZZPasswordExpiryDate", width: '10%',
                    headerCellTemplate: function (header, info) {
                        $('<div>').html("Password <br/> Expiry Date").appendTo(header);
                    }
                },
                { dataField: "IPAddress", width: '9%', caption: "IP Address" },
                { dataField: "ZZUserType", width: '9%', caption: "User Type" },
                { dataField: "IsActive", width: '7%', caption: "Active" },
                {
                    //dataField: "ZZAction", width: "15%", caption: "Action", alignment: "center", allowFiltering: false, allowExporting: false, cellTemplate: function (container, options) {
                    //    $("<div>")
                    //        .append(options.value)
                    //        .appendTo(container);
                    //}
                    dataField: "", width: '18%', alignment: "center", caption: "Action", cellTemplate: function (container, options) {
                        $("<div id='Edit' data-toggle='modal' data-target='#PopUpAdd'>").dxButton({
                            class: "btn btn-danger",
                            icon: "fa fa-pencil",
                            hint: "Edit User",
                            onClick: function () {
                                EditUser(options.data.UserId)
                            }
                        }).append(options.value).appendTo(container);
                        $("<div id='Active' data-toggle='modal' data-target='#PopUpActive'>").dxButton({
                            class: "btn btn-danger",
                            hint: "Change User Status",
                            icon: "fa fa-exchange",
                            onClick: function () {
                                EditStatus(options.data.UserId)
                            }
                        }).append(options.value).appendTo(container);
                        $("<div id='Delete'>").dxButton({
                            class: "btn btn-danger",
                            hint: "Delete User",
                            icon: "fa fa-trash-o",
                            onClick: function () {
                                DeleteUser(options.data.UserId)
                            }
                        }).append(options.value).appendTo(container);
                         $("<div id='Active' data-toggle='modal'>").dxButton({
                            class: "btn btn-danger",
                            hint: "Change User Status",
                            icon: "fa fa-key",
                            onClick: function () {
                                OpenPopupChangePwd(options.data.EmailID,options.data.UserId)
                            }
                        }).append(options.value).appendTo(container);
                    }
                },
            ],
            filterRow: { visible: true },
            showRowLines: true,
            showBorders: true,
        });

    }

    function EditStatus(UserMasterId) {
        debugger
         var obj = $.grep(ListUser, function (obj) {
             return obj.UserId == UserMasterId;
             return obj.FirstName == FirstName;
         });
        $("#HiddenUserId").val(UserMasterId);

        $("#txtFNameStatus").dxTextBox('instance').option('value', obj[0].FirstName + " " + obj[0].LastName);
        $("#txtEmailStatus").dxTextBox('instance').option('value', obj[0].EmailID);
        $("#chkActiveStatus").dxCheckBox('instance').option('value', obj[0].IsActive);

        // $("#txtFNameStatus").val(obj[0].FirstName + " " + obj[0].LastName);
        // $("#txtEmailStatus").val(obj[0].EmailID);
//$("#chkActiveStatus").dxSelectBox('instance').option('value', obj[0].IsActive);
    }

    function EditUser(UserMasterId) {
        $("#txtPassword").dxTextBox('instance').option('readOnly', true);
        $("#ddlUserType").dxSelectBox('instance').option('readOnly', true);
        $("#myModalLabel").text("Edit User");
        $("#PopUpAdd").modal("show");
         var obj = $.grep(ListUser, function (obj) {
                return obj.UserId == UserMasterId;
         });
        $("#HiddenUserId").val(UserMasterId);
        $("#ddlTitle").dxSelectBox('instance').option('value', obj[0].SalutationParaId);
        $("#txtFName").dxTextBox('instance').option('value', obj[0].FirstName);
        $("#txtMName").dxTextBox('instance').option('value', obj[0].MiddleName);
        $("#txtLName").dxTextBox('instance').option('value', obj[0].LastName);
        $("#txtEmail").dxTextBox('instance').option('value', obj[0].EmailID);
        $("#txtMobileNo").dxTextBox('instance').option('value',obj[0].Mobile);
        //$("#txtPassword").dxTextBox('instance').option('value', obj[0].Password);
        //$('#txtPasswordExpDate').dxDateBox('instance').option('value', obj[0].ZZPasswordExpiryDate);
        $("#txtIPAddress").dxTextBox('instance').option('value', obj[0].IPAddress);
        $("#ddlUserType").dxSelectBox('instance').option('value', obj[0].UserTypeParaId);
        //$("#ddlIdentityType").dxSelectBox('instance').option('value', obj[0].IdentityId);
        //$("#chkActive").dxCheckBox('instance').option('value', obj[0].IsActive);
        $("#HdnSelSuperStockists").val(obj[0].PermittedSuperstockistIds);
        
        if (obj[0].UserTypeParaId == "23") {
            $("#BtnSuper").attr('style', 'display: block');
        }
        else {
            $("#BtnSuper").attr('style', 'display: none');
        }

    }

    function IdentityGetByUserType() {
        try {
            var dataWithAntiforgeryToken = ({ '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() });
            $.ajax({
                url: "../Home/PartyMasterGetForIdentity",
                type: 'POST',
                dataType: 'json',
                async: true,
                data: dataWithAntiforgeryToken,
                success: function (Response) {
                    if (Response.StatusId != "99") {
                        ListIdentityType = Response.Result;
                      $("#ddlIdentityType").dxSelectBox({
                          height: 30,
                          dataSource: new DevExpress.data.ArrayStore({
                               data: ListIdentityType,
                               key: "PartyID"
                           }),
                           displayExpr: "Party",
                           valueExpr: "PartyID",
                           placeholder: "Select Company",
                           onValueChanged: function (data) {
                               varIdentityType = data.value;
                           }
                      });
                    }
                    else {
                        alert(Response.Status);
                    }
                },
                error: function (xhr) {
                    alert("Data size is too large!");
                }
            });
        }
        catch (e) {
            alert("Data size is too large!");
        }
    }

    function UserMasterGetAll() {
        try {
            var dataWithAntiforgeryToken = ({ '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() });
            loadPanel.show();
            $.ajax({
                url: "../Home/UserMasterGetAll",
                type: 'POST',
                dataType: 'json',
                async: true,
                data: dataWithAntiforgeryToken,
                success: function (Response) {
                    if (Response.StatusId != "99") {
                        ListUser = Response.Result;
                        loadPanel.hide();
                        BindUserMaster();
                    }
                    else {
                        loadPanel.hide();
                        alert(Response.Status);
                    }
                },
                error: function (xhr) {
                    loadPanel.hide();
                    alert("Data size is too large!");
                }
            });
        }
        catch (e) {
            loadPanel.hide();
            alert("Data size is too large!");
        }
    }

    function UserMasterInsert() {
        try {
            if (ValidateModal()) {
                loadPanel.show();
                var modal = {};
                var ObjUserList = [];
                if ($("#HiddenUserId").val() == undefined || $("#HiddenUserId").val() == "") {
                    modal.UserId = 0;
                }
                else {
                    modal.UserId = $("#HiddenUserId").val();
                }

                modal.SalutationParaId = $("#ddlTitle").dxSelectBox('instance').option('value');
                modal.FirstName = $("#txtFName").dxTextBox('instance').option('value');
                modal.MiddleName = $("#txtMName").dxTextBox('instance').option('value');
                modal.LastName = $("#txtLName").dxTextBox('instance').option('value');
                modal.EmailID = $("#txtEmail").dxTextBox('instance').option('value');
                modal.Mobile = $("#txtMobileNo").dxTextBox('instance').option('value');
                modal.Password = $("#txtPassword").dxTextBox('instance').option('value');
                modal.PasswordExpiryDate = $('#txtPasswordExpDate').dxDateBox('instance').option('value');
                modal.IPAddress = $("#txtIPAddress").dxTextBox('instance').option('value');
                modal.UserTypeParaId = $("#ddlUserType").dxSelectBox('instance').option('value');
                modal.IdentityId = $("#ddlIdentityType").dxSelectBox('instance').option('value');
                modal.IsActive = $("#chkActive").dxCheckBox('instance').option('value');
                modal.PermittedSuperstockistIds = $("#HdnSelSuperStockists").val();

                ObjUserList.push(modal);
                var data = JSON.stringify({ objdbmlUser: ObjUserList });
                $.ajax({
                    url: "../Home/UserMasterInsertUpdate",
                    type: 'POST',
                    dataType: 'json',
                    async: true,
                    data: data,
                    contentType: "application/json; charset=utf-8",
                    success: function (Response) {
                        debugger
                        loadPanel.hide();
                        $("#PopUpAdd").modal("hide");
                        UserMasterGetAll();
                    },
                    error: function (xhr) {
                        loadPanel.hide();
                        alert("Data size is too large!");
                    }
                });
                window.location.reload();
            }
        }
        catch (e) {
            loadPanel.hide();
            alert("Data size is too large!");
        }
    }

    function UserMasterStatusUpdate() {
        try {
            debugger
            loadPanel.show();
            var modal = {};
            var ObjUserList = [];
            if ($("#HiddenUserId").val() == undefined || $("#HiddenUserId").val() == "")
                modal.UserId = 0;
            else
                modal.UserId = $("#HiddenUserId").val();

            modal.IsActive  = $("#chkActiveStatus").dxCheckBox('instance').option('value');
            ObjUserList.push(modal);
            var data = JSON.stringify({ objdbmlUser: ObjUserList });
            $.ajax({
                url: "../Home/UserMasterStatusUpdate",
                type: 'POST',
                dataType: 'json',
                async: true,
                data: data,
                contentType: "application/json; charset=utf-8",
                success: function (Response) {
                    loadPanel.hide();
                    UserMasterGetAll();
                },
                error: function (xhr) {
                    loadPanel.hide();
                    alert("Data size is too large!");
                }
            });
        }
        catch (e) {
            loadPanel.hide();
            alert("Data size is too large!");
        }
    }

    function DeleteUser(intUserId) {
        try {
         loadPanel.show();
         var result = DevExpress.ui.dialog.confirm("Do you want to delete ...?", "Confirm changes");
             result.done(function (dialogResult) {
                 if (dialogResult) {
                     var data = {'intUserId': intUserId };
                     var dataWithAntiforgeryToken = $.extend(data, { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() });
                     $.ajax({
                         url: "../Home/UserMasterDelete",
                         type: 'POST',
                         dataType: 'json',
                         async: true,
                         data: dataWithAntiforgeryToken,
                         success: function (Response) {
                             if (Response.StatusId != "99") {
                                 ListUser = Response.Result;
                                 $("#tblUserMaster").dxDataGrid('instance').option("dataSource", ListUser);
                                 loadPanel.hide();
                             }
                             else {
                                 loadPanel.hide();
                                 alert(Response.Status);
                             }
                         },
                         error: function (xhr) {
                             loadPanel.hide();
                             alert("Data size is too large!");
                         }
                     });

                 }
             });
        }
        catch (e) {
            loadPanel.hide();
            alert("Data size is too large!");
        }
        }

    function ClearControls() {
        $("#HiddenUserId").val(0);
        $("#txtPassword").dxTextBox('instance').option('readOnly', false);
        $("#ddlUserType").dxSelectBox('instance').option('readOnly', false);
        $("#myModalLabel").text("Add User");
        $("#PopUpAdd").modal("show");
        $("#ddlTitle").dxSelectBox('instance').option('value', '');
        $("#txtFName").dxTextBox('instance').option('value', '');
        $("#txtMName").dxTextBox('instance').option('value', '');
        $("#txtLName").dxTextBox('instance').option('value', '');
        $("#txtEmail").dxTextBox('instance').option('value', '');
        $("#txtMobileNo").dxTextBox('instance').option('value', '');
        $("#txtPassword").dxTextBox('instance').option('value', '');
        $('#txtPasswordExpDate').dxDateBox('instance').option('value', '');
        $("#txtIPAddress").dxTextBox('instance').option('value', '');
        $("#ddlUserType").dxSelectBox('instance').option('value', 0);
        $("#ddlIdentityType").dxSelectBox('instance').option('value', 0);
    }

    function ValidateModal() {
    try {
        var msg = "";
        if ($("#ddlTitle").dxSelectBox('instance').option('value') == '' || $("#ddlTitle").dxSelectBox('instance').option('value') == undefined || $("#ddlTitle").dxSelectBox('instance').option('value') == null) {
            msg += "<br /> \n Title \n";
        }
        if ($("#txtFName").dxTextBox('instance').option('value') == '' || $("#txtFName").dxTextBox('instance').option('value') == undefined || $("#txtFName").dxTextBox('instance').option('value') == null) {
            msg += "<br /> \n First Name \n";
        }
        if ($("#txtLName").dxTextBox('instance').option('value') == '' || $("#txtLName").dxTextBox('instance').option('value') == undefined || $("#txtLName").dxTextBox('instance').option('value') == null) {
            msg += "<br /> \n Last Name \n";
        }
        if ($("#HiddenUserId").val() == undefined || $("#HiddenUserId").val() == "") {
            if ($("#txtEmail").dxTextBox('instance').option('value') == '' || $("#txtEmail").dxTextBox('instance').option('value') == undefined || $("#txtEmail").dxTextBox('instance').option('value') == null) {
                msg += "<br /> \n Email \n";
            }
        }
        if ($("#txtMobileNo").dxTextBox('instance').option('value') == '' || $("#txtMobileNo").dxTextBox('instance').option('value') == undefined || $("#txtMobileNo").dxTextBox('instance').option('value') == null) {
            msg += "<br /> \n Mobile No. \n";
        }
       if ($("#HiddenUserId").val() == undefined || $("#HiddenUserId").val() == "") {
           if ($("#txtPassword").dxTextBox('instance').option('value') == '' || $("#txtPassword").dxTextBox('instance').option('value') == undefined || $("#txtPassword").dxTextBox('instance').option('value') == null) {
             msg += "<br /> \n Password \n";
           }
       }
        if ($("#txtPasswordExpDate").dxDateBox('instance').option('value') == '' || $("#txtPasswordExpDate").dxDateBox('instance').option('value') == undefined || $("#txtPasswordExpDate").dxDateBox('instance').option('value') == null) {
            msg += "<br /> \n Password Exp. Date \n";
        }
        if ($("#ddlUserType").dxSelectBox('instance').option('value') == '' || $("#ddlUserType").dxSelectBox('instance').option('value') == undefined || $("#ddlUserType").dxSelectBox('instance').option('value') == null) {
            msg += "<br /> \n User Type \n";
        }
        if ($("#HiddenUserId").val() == undefined || $("#HiddenUserId").val() == "") {
            if ($("#ddlIdentityType").dxSelectBox('instance').option('value') == '' || $("#ddlIdentityType").dxSelectBox('instance').option('value') == undefined || $("#ddlIdentityType").dxSelectBox('instance').option('value') == null) {
                msg += "<br /> \n Company Name \n";
            }
        }
       if ($("#HiddenUserId").val() == undefined || $("#HiddenUserId").val() == "") {
           if ($("#chkActive").dxCheckBox('instance').option('value') == '' || $("#chkActive").dxCheckBox('instance').option('value') == undefined || $("#chkActive").dxCheckBox('instance').option('value') == null) {
            msg += "<br /> \n Active \n";
           }
       }
        if (msg != "") {
            alert("Please fill valid details in the fields below: \n" + msg);
            return false;
        }

        if (varddlUserType == "23") {
            if ($("#HdnSelSuperStockists").val() == "") {
                alert("Please select Super Stockists");
                return false;
            }
        }
        
        if ($("#ddlUserType").dxSelectBox('instance').option('value') == "21") {
            if ($("#ddlIdentityType").dxSelectBox('instance').option('value') == '' || $("#ddlIdentityType").dxSelectBox('instance').option('value') == undefined || $("#ddlIdentityType").dxSelectBox('instance').option('value') == null) {
                alert("Please select Company");
                return false;
            }
        }
        return true;
    } catch (e) {
        alert(e.message);
    }
    }
    function cancelPopup() {
        $("#HiddenUserId").val('');
        $("#txtCPEmail").dxTextBox('instance').option('value', '');
        $("#txtChangePassword").dxTextBox('instance').option('value', '');
        $("#txtConfirmPassword").dxTextBox('instance').option('value', '');
        $("#PopUpChangePassword").modal("hide");
    }

    function UserMasterChangePassword() {
        try {
            debugger
                 if ($("#txtCPEmail").dxTextBox('instance').option('value') == "") {
                    alert("EmailId Required !! ")
                    return
                  }
                if ($("#txtChangePassword").dxTextBox('instance').option('value') == "") {
                    alert("New Password Required !! ")
                    return
                 }
                if ($("#txtConfirmPassword").dxTextBox('instance').option('value') == "") {
                    alert("Confirm Password Required !! ")
                    return
                }
               if ($("#HiddenUserId").val() == "") {
                    return
                }
                var data = { 'UserId': $("#HiddenUserId").val(), 'NewPassword': $("#txtChangePassword").dxTextBox('instance').option('value') };
                var dataWithAntiforgeryToken = $.extend(data, { '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() });
                loadPanel.show();
            $.ajax({
                url: '@Url.Action("UserMasterChangePasswordNew", "Home")',
                type: 'POST',
                dataType: 'json',
                async: true,
                data: dataWithAntiforgeryToken,
                success: function (Response) {
                    loadPanel.hide();
                    if (Response.StatusId != "99") {
                        VarStatus = Response.Status;
                        alert(Response.Status);
                        cancelPopup()

                    }
                    else {
                        alert(Response.Status);
                    }
                },
                error: function (xhr) {
                    loadPanel.hide();
                    alert("Data size is too large!");
                }
            });
        }
        catch (e) {
            loadPanel.hide();
            alert("Data size is too large!");
        }
    }

    function OpenPopupChangePwd(varEmailId,UserMasterId) {
        $("#PopUpChangePassword").modal("show");
        $("#HiddenUserId").val(UserMasterId);
        $("#txtCPEmail").dxTextBox('instance').option('value', varEmailId);
        $("#txtChangePassword").dxTextBox('instance').option('value', '');
        $("#txtConfirmPassword").dxTextBox('instance').option('value', '');
    }

    function CheckPassword() {
        debugger
            if ($("#txtChangePassword").dxTextBox('instance').option('value') === $("#txtConfirmPassword").dxTextBox('instance').option('value')) {
            }
            else {
                $("#txtConfirmPassword").focus();
                alert("Password doesn't match.");
            }
        }
    function ShowSuperStockistsPopup() {
        var dataWithAntiforgeryToken = ({ '__RequestVerificationToken': $("input[name='__RequestVerificationToken']").val() });
        loadPanel.show();
        var holderHTML = "";
        var showtr = 0;
        var SelStockists = ',' + $("#HdnSelSuperStockists").val() + ',';
        $.ajax({
            url: "../Home/PartyMasterGetAll",
            type: 'POST',
            dataType: 'json',
            async: false,
            data: dataWithAntiforgeryToken,
            success: function (Response) {
                if (Response.StatusId != "99") {
                    PartyList = Response.Result;
                    for (var i = 0; i < PartyList.length; i++) {
                        value = PartyList[i]
                        sel = "";
                      if (value != null) {
                          showtr += 1;
                          if (showtr == 1) {
                              holderHTML += '<tr id="row' + value.PartyID + '">';
                          }
                          var incStr = SelStockists.includes(','+value.PartyID+',');
                          if (incStr)
                              sel = "checked"
                          else
                              sel = ""

                          holderHTML += '<td><input id="checkboxCustom1" class="checkboxCustom1" type="checkbox" value="' + value.PartyID + '" onclick="SetSelectedSuperStockists();" ' + sel + ' />';
                          holderHTML += '<td width="450px" nowrap>&nbsp;' + value.Party + '</td>';
                          if (showtr == 3) {
                              showtr = 0;
                              holderHTML += '</tr>';
                          }
                        }

                    }
                    $('#PlaceHolder1').html(holderHTML);


                    loadPanel.hide();
                }
                else {
                    loadPanel.hide();
                    //$('#ddlCustomer').dxSelectBox('instance').option('value', '');
                    alert(Response.Status);
                }
            },
            error: function (xhr) {
                loadPanel.hide();
                alert("Data size is too large!");
            }
        });
        $("#PopUpSuperstockists").modal("show");
    }

    function SetSelectedSuperStockists() {
        var sList = "";
        $("#HdnSelSuperStockists").val('');
        $('.checkboxCustom1').each(function (index, obj) {
            if (this.checked === true) {
                if (sList == "") {
                    sList = $(this).val();
                }
                else {
                    sList += ',' + $(this).val();
                }
            }
        });

        $("#HdnSelSuperStockists").val(sList);
        //$('input[type=checkbox]').each(function () {
        //    sList += "(" + $(this).val() + "-" + (this.checked ? "checked" : "not checked") + ")";
        //});
    }

    function CloseSuperstockistPopup() {
        $("#PopUpSuperstockists").modal("hide");
    }
</script>